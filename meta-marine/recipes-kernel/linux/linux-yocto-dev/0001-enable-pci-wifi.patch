From 02fd2994fb3fbbe0bdc95d498739418e57c33490 Mon Sep 17 00:00:00 2001
From: Trinh Viet Quang <vietquang0708@gmail.com>
Date: Tue, 2 Sep 2025 17:09:37 +0700
Subject: [PATCH] enable pci wifi

Upstream-Status: Inappropriate [oe specific]

Signed-off-by: Trinh Viet Quang <vietquang0708@gmail.com>
---
 .../boot/dts/rockchip/rk3588-nanopc-t6.dtsi   | 20 +++++++++++++++++--
 1 file changed, 18 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/rockchip/rk3588-nanopc-t6.dtsi b/arch/arm64/boot/dts/rockchip/rk3588-nanopc-t6.dtsi
index f0784be6e2a7..a61ab27ee464 100644
--- a/arch/arm64/boot/dts/rockchip/rk3588-nanopc-t6.dtsi
+++ b/arch/arm64/boot/dts/rockchip/rk3588-nanopc-t6.dtsi
@@ -657,7 +657,7 @@ &pcie2x1l0 {
 	// control the power enable for lane 0
 	// - Lane 0 is used for M.2 2.5G Ethernet
 	//===============================================
-	reset-gpios = <&gpio4 RK_PB3 GPIO_ACTIVE_LOW>;
+	reset-gpios = <&gpio4 RK_PB3 GPIO_ACTIVE_LOW>;
 	vpcie3v3-supply = <&vcc_3v3_pcie20>;
 	pinctrl-names = "default";
 	pinctrl-0 = <&pcie2_0_rst>;
@@ -700,11 +700,27 @@ &pcie2x1l2 {
 	// PWR_EN is connected to 1 RK_PA7
 	// - RESET is connected to 4 RK_PA2
 	//===============================================
-	reset-gpios = <&gpio4 RK_PA2 GPIO_ACTIVE_LOW>;
+	reset-gpios = <&gpio4 RK_PA2 GPIO_ACTIVE_HIGH>;
 	vpcie3v3-supply = <&vcc3v3_pcie2x1l2>;
 	pinctrl-names = "default";
 	pinctrl-0 = <&pcie2_2_rst>;
 	status = "okay";
+
+	pcie@0,0 {
+		reg = <0x200000 0 0 0 0>;
+		#address-cells = <3>;
+		#size-cells = <2>;
+		ranges;
+		device_type = "pci";
+		bus-range = <0x20 0x2f>;
+
+		wifi: wifi@0,0 {
+			compatible = "pci14e4,449d";
+			reg = <0x210000 0 0 0 0>;
+			clocks = <&hym8563>;
+			clock-names = "lpo";
+		};
+	};
 };
 
 &pcie30phy {
-- 
2.43.0

